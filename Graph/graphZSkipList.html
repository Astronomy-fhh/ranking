<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>ZSkiplist</title>
    <script src="https://cdn.bootcss.com/jquery/3.4.1/jquery.js"></script>
</head>
<body>
<canvas id="zSkipList" style="background-color: beige"></canvas>


</body>
</html>
<script>

    $(document).ready(function (){
        paintZSkipList()
    })
    function paintZSkipList(){
        $.ajax({
            url:"http://localhost:8087/zSkipListGraph",    //请求的url地址
            dataType:"json",   //返回格式为json
            async:true,//请求是否异步，默认为异步，这也是ajax重要特性
            data:{"id":"value"},    //参数值
            type:"POST",   //请求方式
            beforeSend:function(){
                //请求前的处理
            },
            success:function(data,status){
                console.log(data,status)
                draw(data)
            },
            complete:function(){
                //请求完成的处理
            },
            error:function(){
                //请求出错处理
            }
        });

    }

    const canvas_height = 1000
    const canvas_wight = 1600
    const node_height = 50
    const node_wight = 100
    const node_left_interval = 50
    const node_top_interval = 50


    function draw(data){
        var canvas=document.getElementById("zSkipList");
        canvas.height = canvas_height
        canvas.width = canvas_wight
        var ctx=canvas.getContext("2d");

        for (let k in data){
            let line = data[k]
            drawPoint(ctx,k,line['point'])
            drawScore(ctx,k,line['score'])
            drawKey(ctx,k,line['key'])
            drawLayers(ctx,k,line['layer'])
        }
    }

    function drawLayers(ctx,idx,layer){
        for (let k in layer){
            drawLayer(ctx,idx,k,layer[k])
        }
    }

    function drawLayer(ctx,idx,idx2,score){
        ctx.beginPath()
        let x = (node_wight + node_left_interval)*idx + node_left_interval
        let y = canvas_height - node_top_interval - node_height * (4 + parseInt(idx2))

        ctx.rect(x,y, node_wight, node_height);
        ctx.lineWidth = 4;
        ctx.strokeStyle = '#ECE7E6';
        ctx.stroke();
        ctx.fillStyle = '#EB4334';
        ctx.fill();
        drawText(ctx, score, x + node_wight/ 2, y + node_height / 2)
    }

    function drawScore(ctx,idx,score){
        ctx.beginPath()
        let x = (node_wight + node_left_interval)*idx + node_left_interval
        let y = canvas_height - node_top_interval - node_height * 2
        ctx.rect(x,y, node_wight, node_height);
        ctx.lineWidth = 4;
        ctx.strokeStyle = '#ECE7E6';
        ctx.stroke();
        ctx.fillStyle = '#4586F3';
        ctx.fill();
        drawText(ctx, score, x + node_wight/ 2, y + node_height / 2)
    }

    function drawPoint(ctx,idx,score){
        ctx.beginPath()
        let x = (node_wight + node_left_interval)*idx + node_left_interval
        let y = canvas_height - node_top_interval - node_height
        ctx.rect(x,y, node_wight, node_height);
        ctx.lineWidth = 4;
        ctx.strokeStyle = '#ECE7E6';
        ctx.stroke();
        ctx.fillStyle = '#EB4334';
        ctx.fill();
        drawText(ctx, score, x + node_wight/ 2, y + node_height / 2)
    }

    function drawText(ctx, text, x, y){
        ctx.beginPath()
        ctx.fillStyle = '#C4C2C1';
        ctx.font = '18px sans-serif';
        ctx.textAlign = 'center';
        ctx.fillText(text, x,y);
        ctx.fill();
    }

    function drawKey(ctx,idx,key){
        ctx.beginPath()
        let x = (node_wight + node_left_interval)*idx + node_left_interval
        let y = canvas_height - node_top_interval - node_height * 3
        ctx.rect(x, y, node_wight, node_height);
        ctx.lineWidth = 1;
        ctx.strokeStyle = '#ECE7E6';
        ctx.fillStyle = '#047014';
        ctx.fill();
        drawText(ctx, key, x + node_wight/2, y + node_height/2)
    }

</script>